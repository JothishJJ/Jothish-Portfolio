import { Args, Flags } from '@oclif/core';
import { BlueprintCommand } from '../../baseCommands.js';
import { blueprintAddCore } from '../../cores/blueprints/index.js';
export default class AddCommand extends BlueprintCommand {
    static description = 'Add a Resource to a Blueprint';
    static examples = [
        '<%= config.bin %> <%= command.id %> function',
        '<%= config.bin %> <%= command.id %> function --helpers',
        '<%= config.bin %> <%= command.id %> function --name my-function',
        '<%= config.bin %> <%= command.id %> function --name my-function --fn-type document-create',
        '<%= config.bin %> <%= command.id %> function --name my-function --fn-type document-create --fn-type document-update --lang js',
    ];
    static args = {
        type: Args.string({
            description: 'Type of Resource to add (e.g. function)',
            options: ['function'],
            required: true,
        }),
    };
    static flags = {
        example: Flags.string({
            description: 'Example to use for the Resource',
            aliases: ['recipe'],
            exclusive: ['name', 'fn-type', 'language', 'javascript', 'fn-helpers', 'fn-installer'], // set automatically
        }),
        name: Flags.string({
            description: 'Name of the Resource to add',
            char: 'n',
        }),
        'fn-type': Flags.string({
            description: 'Document change event(s) that should trigger the function; you can specify multiple events by specifying this flag multiple times',
            options: ['document-create', 'document-delete', 'document-update', 'document-publish'],
            aliases: ['function-type'],
            multiple: true,
            multipleNonGreedy: true,
            dependsOn: ['name'],
        }),
        language: Flags.string({
            description: 'Language of the new Function',
            aliases: ['function-language', 'fn-language', 'lang'],
            options: ['ts', 'js'],
            default: 'ts',
        }),
        javascript: Flags.boolean({
            description: 'Use JavaScript instead of TypeScript',
            aliases: ['js'],
            exclusive: ['language'],
        }),
        'fn-helpers': Flags.boolean({
            description: 'Add helpers to the new Function',
            aliases: ['function-helpers', 'helpers'],
            // default: true, // ask. for now
            allowNo: true,
        }),
        'fn-installer': Flags.string({
            description: 'How to install the @sanity/functions helpers',
            aliases: ['function-installer', 'installer'],
            options: ['skip', 'npm', 'pnpm', 'yarn'],
        }),
        install: Flags.boolean({
            description: 'Shortcut for --fn-installer npm',
            char: 'i',
            exclusive: ['fn-installer'],
        }),
    };
    async run() {
        const { success, error } = await blueprintAddCore({
            bin: this.config.bin,
            log: (msg) => this.log(msg),
            blueprint: this.blueprint,
            args: this.args,
            flags: this.flags,
        });
        if (!success)
            this.error(error);
    }
}
