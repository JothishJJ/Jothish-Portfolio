{"version":3,"file":"image-url.umd.js","sources":["../../src/parseAssetId.ts","../../src/parseSource.ts","../../src/urlForImage.ts","../../src/builder.ts"],"sourcesContent":["const example = 'image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg'\n\nexport default function parseAssetId(ref: string) {\n  const [, id, dimensionString, format] = ref.split('-')\n\n  if (!id || !dimensionString || !format) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  const [imgWidthStr, imgHeightStr] = dimensionString.split('x')\n\n  const width = +imgWidthStr\n  const height = +imgHeightStr\n\n  const isValidAssetId = isFinite(width) && isFinite(height)\n  if (!isValidAssetId) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  return {id, width, height, format}\n}\n","import {\n  SanityAsset,\n  SanityImageObject,\n  SanityImageSource,\n  SanityImageWithAssetStub,\n  SanityReference,\n} from './types'\n\nconst isRef = (src: SanityImageSource): src is SanityReference => {\n  const source = src as SanityReference\n  return source ? typeof source._ref === 'string' : false\n}\n\nconst isAsset = (src: SanityImageSource): src is SanityAsset => {\n  const source = src as SanityAsset\n  return source ? typeof source._id === 'string' : false\n}\n\nconst isAssetStub = (src: SanityImageSource): src is SanityImageWithAssetStub => {\n  const source = src as SanityImageWithAssetStub\n  return source && source.asset ? typeof source.asset.url === 'string' : false\n}\n\n// Detect in-progress uploads (has upload key but no complete asset reference)\nexport const isInProgressUpload = (src: SanityImageSource): boolean => {\n  if (typeof src === 'object' && src !== null) {\n    const obj = src as any\n    // Check if it has an upload key (indicating in-progress upload)\n    return obj._upload && (!obj.asset || !obj.asset._ref)\n  }\n  return false\n}\n\n// Convert an asset-id, asset or image to an image record suitable for processing\n// eslint-disable-next-line complexity\nexport default function parseSource(source?: SanityImageSource) {\n  if (!source) {\n    return null\n  }\n\n  let image: SanityImageObject\n\n  if (typeof source === 'string' && isUrl(source)) {\n    // Someone passed an existing image url?\n    image = {\n      asset: {_ref: urlToId(source)},\n    }\n  } else if (typeof source === 'string') {\n    // Just an asset id\n    image = {\n      asset: {_ref: source},\n    }\n  } else if (isRef(source)) {\n    // We just got passed an asset directly\n    image = {\n      asset: source,\n    }\n  } else if (isAsset(source)) {\n    // If we were passed an image asset document\n    image = {\n      asset: {\n        _ref: source._id || '',\n      },\n    }\n  } else if (isAssetStub(source)) {\n    // If we were passed a partial asset (`url`, but no `_id`)\n    image = {\n      asset: {\n        _ref: urlToId(source.asset.url),\n      },\n    }\n  } else if (typeof source.asset === 'object') {\n    // Probably an actual image with materialized asset\n    image = {...source}\n  } else {\n    // We got something that does not look like an image, or it is an image\n    // that currently isn't sporting an asset.\n    return null\n  }\n\n  const img = source as SanityImageObject\n  if (img.crop) {\n    image.crop = img.crop\n  }\n\n  if (img.hotspot) {\n    image.hotspot = img.hotspot\n  }\n\n  return applyDefaults(image)\n}\n\nfunction isUrl(url: string) {\n  return /^https?:\\/\\//.test(`${url}`)\n}\n\nfunction urlToId(url: string) {\n  const parts = url.split('/').slice(-1)\n  return `image-${parts[0]}`.replace(/\\.([a-z]+)$/, '-$1')\n}\n\n// Mock crop and hotspot if image lacks it\nfunction applyDefaults(image: SanityImageObject) {\n  if (image.crop && image.hotspot) {\n    return image as Required<SanityImageObject>\n  }\n\n  // We need to pad in default values for crop or hotspot\n  const result = {...image}\n\n  if (!result.crop) {\n    result.crop = {\n      left: 0,\n      top: 0,\n      bottom: 0,\n      right: 0,\n    }\n  }\n\n  if (!result.hotspot) {\n    result.hotspot = {\n      x: 0.5,\n      y: 0.5,\n      height: 1.0,\n      width: 1.0,\n    }\n  }\n\n  return result as Required<SanityImageObject>\n}\n","import parseAssetId from './parseAssetId'\nimport parseSource, {isInProgressUpload} from './parseSource'\nimport {\n  CropSpec,\n  HotspotSpec,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAsset,\n  SanityAsset,\n  SanityImageFitResult,\n  SanityImageRect,\n  SanityReference,\n} from './types'\n\nexport const SPEC_NAME_TO_URL_NAME_MAPPINGS = [\n  ['width', 'w'],\n  ['height', 'h'],\n  ['format', 'fm'],\n  ['download', 'dl'],\n  ['blur', 'blur'],\n  ['sharpen', 'sharp'],\n  ['invert', 'invert'],\n  ['orientation', 'or'],\n  ['minHeight', 'min-h'],\n  ['maxHeight', 'max-h'],\n  ['minWidth', 'min-w'],\n  ['maxWidth', 'max-w'],\n  ['quality', 'q'],\n  ['fit', 'fit'],\n  ['crop', 'crop'],\n  ['saturation', 'sat'],\n  ['auto', 'auto'],\n  ['dpr', 'dpr'],\n  ['pad', 'pad'],\n  ['frame', 'frame'],\n]\n\nexport default function urlForImage(options: ImageUrlBuilderOptions): string {\n  let spec = {...(options || {})}\n  const source = spec.source\n  delete spec.source\n\n  const image = parseSource(source)\n  if (!image) {\n    if (source && isInProgressUpload(source)) {\n      // This is a placeholder image that will be replaced with the actual image when the upload is complete\n      // This is a 0x0 transparent PNG image\n      return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8HwQACfsD/QNViZkAAAAASUVORK5CYII='\n    }\n    throw new Error(`Unable to resolve image URL from source (${JSON.stringify(source)})`)\n  }\n\n  const id = (image.asset as SanityReference)._ref || (image.asset as SanityAsset)._id || ''\n  const asset = parseAssetId(id)\n\n  // Compute crop rect in terms of pixel coordinates in the raw source image\n  const cropLeft = Math.round(image.crop.left * asset.width)\n  const cropTop = Math.round(image.crop.top * asset.height)\n  const crop = {\n    left: cropLeft,\n    top: cropTop,\n    width: Math.round(asset.width - image.crop.right * asset.width - cropLeft),\n    height: Math.round(asset.height - image.crop.bottom * asset.height - cropTop),\n  }\n\n  // Compute hot spot rect in terms of pixel coordinates\n  const hotSpotVerticalRadius = (image.hotspot.height * asset.height) / 2\n  const hotSpotHorizontalRadius = (image.hotspot.width * asset.width) / 2\n  const hotSpotCenterX = image.hotspot.x * asset.width\n  const hotSpotCenterY = image.hotspot.y * asset.height\n  const hotspot = {\n    left: hotSpotCenterX - hotSpotHorizontalRadius,\n    top: hotSpotCenterY - hotSpotVerticalRadius,\n    right: hotSpotCenterX + hotSpotHorizontalRadius,\n    bottom: hotSpotCenterY + hotSpotVerticalRadius,\n  }\n\n  // If irrelevant, or if we are requested to: don't perform crop/fit based on\n  // the crop/hotspot.\n  if (!(spec.rect || spec.focalPoint || spec.ignoreImageParams || spec.crop)) {\n    spec = {...spec, ...fit({crop, hotspot}, spec)}\n  }\n\n  return specToImageUrl({...spec, asset})\n}\n\n// eslint-disable-next-line complexity\nfunction specToImageUrl(spec: ImageUrlBuilderOptionsWithAsset) {\n  const cdnUrl = (spec.baseUrl || 'https://cdn.sanity.io').replace(/\\/+$/, '')\n  const vanityStub = spec.vanityName ? `/${spec.vanityName}` : ''\n  const filename = `${spec.asset.id}-${spec.asset.width}x${spec.asset.height}.${spec.asset.format}${vanityStub}`\n  const baseUrl = `${cdnUrl}/images/${spec.projectId}/${spec.dataset}/${filename}`\n\n  const params = []\n\n  if (spec.rect) {\n    // Only bother url with a crop if it actually crops anything\n    const {left, top, width, height} = spec.rect\n    const isEffectiveCrop =\n      left !== 0 || top !== 0 || height !== spec.asset.height || width !== spec.asset.width\n\n    if (isEffectiveCrop) {\n      params.push(`rect=${left},${top},${width},${height}`)\n    }\n  }\n\n  if (spec.bg) {\n    params.push(`bg=${spec.bg}`)\n  }\n\n  if (spec.focalPoint) {\n    params.push(`fp-x=${spec.focalPoint.x}`)\n    params.push(`fp-y=${spec.focalPoint.y}`)\n  }\n\n  const flip = [spec.flipHorizontal && 'h', spec.flipVertical && 'v'].filter(Boolean).join('')\n  if (flip) {\n    params.push(`flip=${flip}`)\n  }\n\n  // Map from spec name to url param name, and allow using the actual param name as an alternative\n  SPEC_NAME_TO_URL_NAME_MAPPINGS.forEach((mapping) => {\n    const [specName, param] = mapping\n    if (typeof spec[specName] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[specName])}`)\n    } else if (typeof spec[param] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[param])}`)\n    }\n  })\n\n  if (params.length === 0) {\n    return baseUrl\n  }\n\n  return `${baseUrl}?${params.join('&')}`\n}\n\nfunction fit(\n  source: {crop: CropSpec; hotspot: HotspotSpec},\n  spec: ImageUrlBuilderOptions\n): SanityImageFitResult {\n  let cropRect: SanityImageRect\n\n  const imgWidth = spec.width\n  const imgHeight = spec.height\n\n  // If we are not constraining the aspect ratio, we'll just use the whole crop\n  if (!(imgWidth && imgHeight)) {\n    return {width: imgWidth, height: imgHeight, rect: source.crop}\n  }\n\n  const crop = source.crop\n  const hotspot = source.hotspot\n\n  // If we are here, that means aspect ratio is locked and fitting will be a bit harder\n  const desiredAspectRatio = imgWidth / imgHeight\n  const cropAspectRatio = crop.width / crop.height\n\n  if (cropAspectRatio > desiredAspectRatio) {\n    // The crop is wider than the desired aspect ratio. That means we are cutting from the sides\n    const height = Math.round(crop.height)\n    const width = Math.round(height * desiredAspectRatio)\n    const top = Math.max(0, Math.round(crop.top))\n\n    // Center output horizontally over hotspot\n    const hotspotXCenter = Math.round((hotspot.right - hotspot.left) / 2 + hotspot.left)\n    let left = Math.max(0, Math.round(hotspotXCenter - width / 2))\n\n    // Keep output within crop\n    if (left < crop.left) {\n      left = crop.left\n    } else if (left + width > crop.left + crop.width) {\n      left = crop.left + crop.width - width\n    }\n\n    cropRect = {left, top, width, height}\n  } else {\n    // The crop is taller than the desired ratio, we are cutting from top and bottom\n    const width = crop.width\n    const height = Math.round(width / desiredAspectRatio)\n    const left = Math.max(0, Math.round(crop.left))\n\n    // Center output vertically over hotspot\n    const hotspotYCenter = Math.round((hotspot.bottom - hotspot.top) / 2 + hotspot.top)\n    let top = Math.max(0, Math.round(hotspotYCenter - height / 2))\n\n    // Keep output rect within crop\n    if (top < crop.top) {\n      top = crop.top\n    } else if (top + height > crop.top + crop.height) {\n      top = crop.top + crop.height - height\n    }\n\n    cropRect = {left, top, width, height}\n  }\n\n  return {\n    width: imgWidth,\n    height: imgHeight,\n    rect: cropRect,\n  }\n}\n\n// For backwards-compatibility\nexport {parseSource}\n","import type {\n  AutoMode,\n  CropMode,\n  FitMode,\n  ImageFormat,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAliases,\n  SanityModernClientLike,\n  Orientation,\n  SanityClientLike,\n  SanityImageSource,\n  SanityProjectDetails,\n} from './types'\nimport urlForImage, {SPEC_NAME_TO_URL_NAME_MAPPINGS} from './urlForImage'\n\nconst validFits = ['clip', 'crop', 'fill', 'fillmax', 'max', 'scale', 'min']\nconst validCrops = ['top', 'bottom', 'left', 'right', 'center', 'focalpoint', 'entropy']\nconst validAutoModes = ['format']\n\nfunction isSanityModernClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityModernClientLike {\n  return client && 'config' in client ? typeof client.config === 'function' : false\n}\n\nfunction isSanityClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityClientLike {\n  return client && 'clientConfig' in client ? typeof client.clientConfig === 'object' : false\n}\n\nfunction rewriteSpecName(key: string) {\n  const specs = SPEC_NAME_TO_URL_NAME_MAPPINGS\n  for (const entry of specs) {\n    const [specName, param] = entry\n    if (key === specName || key === param) {\n      return specName\n    }\n  }\n\n  return key\n}\n\nexport default function urlBuilder(\n  options?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n) {\n  // Did we get a modernish client?\n  if (isSanityModernClientLike(options)) {\n    // Inherit config from client\n    const {apiHost: apiUrl, projectId, dataset} = options.config()\n    const apiHost = apiUrl || 'https://api.sanity.io'\n    return new ImageUrlBuilder(null, {\n      baseUrl: apiHost.replace(/^https:\\/\\/api\\./, 'https://cdn.'),\n      projectId,\n      dataset,\n    })\n  }\n\n  // Did we get a SanityClient?\n  if (isSanityClientLike(options)) {\n    // Inherit config from client\n    const {apiHost: apiUrl, projectId, dataset} = options.clientConfig\n    const apiHost = apiUrl || 'https://api.sanity.io'\n    return new ImageUrlBuilder(null, {\n      baseUrl: apiHost.replace(/^https:\\/\\/api\\./, 'https://cdn.'),\n      projectId,\n      dataset,\n    })\n  }\n\n  // Or just accept the options as given\n  return new ImageUrlBuilder(null, options || {})\n}\n\nexport class ImageUrlBuilder {\n  public options: ImageUrlBuilderOptions\n\n  constructor(parent: ImageUrlBuilder | null, options: ImageUrlBuilderOptions) {\n    this.options = parent\n      ? {...(parent.options || {}), ...(options || {})} // Merge parent options\n      : {...(options || {})} // Copy options\n  }\n\n  withOptions(options: Partial<ImageUrlBuilderOptionsWithAliases>) {\n    const baseUrl = options.baseUrl || this.options.baseUrl\n\n    const newOptions: {[key: string]: any} = {baseUrl}\n    for (const key in options) {\n      if (options.hasOwnProperty(key)) {\n        const specKey = rewriteSpecName(key)\n        newOptions[specKey] = options[key]\n      }\n    }\n\n    return new ImageUrlBuilder(this, {baseUrl, ...newOptions})\n  }\n\n  // The image to be represented. Accepts a Sanity 'image'-document, 'asset'-document or\n  // _id of asset. To get the benefit of automatic hot-spot/crop integration with the content\n  // studio, the 'image'-document must be provided.\n  image(source: SanityImageSource) {\n    return this.withOptions({source})\n  }\n\n  // Specify the dataset\n  dataset(dataset: string) {\n    return this.withOptions({dataset})\n  }\n\n  // Specify the projectId\n  projectId(projectId: string) {\n    return this.withOptions({projectId})\n  }\n\n  // Specify background color\n  bg(bg: string) {\n    return this.withOptions({bg})\n  }\n\n  // Set DPR scaling factor\n  dpr(dpr: number) {\n    // A DPR of 1 is the default - so only include it if we have a different value\n    return this.withOptions(dpr && dpr !== 1 ? {dpr} : {})\n  }\n\n  // Specify the width of the image in pixels\n  width(width: number) {\n    return this.withOptions({width})\n  }\n\n  // Specify the height of the image in pixels\n  height(height: number) {\n    return this.withOptions({height})\n  }\n\n  // Specify focal point in fraction of image dimensions. Each component 0.0-1.0\n  focalPoint(x: number, y: number) {\n    return this.withOptions({focalPoint: {x, y}})\n  }\n\n  maxWidth(maxWidth: number) {\n    return this.withOptions({maxWidth})\n  }\n\n  minWidth(minWidth: number) {\n    return this.withOptions({minWidth})\n  }\n\n  maxHeight(maxHeight: number) {\n    return this.withOptions({maxHeight})\n  }\n\n  minHeight(minHeight: number) {\n    return this.withOptions({minHeight})\n  }\n\n  // Specify width and height in pixels\n  size(width: number, height: number) {\n    return this.withOptions({width, height})\n  }\n\n  // Specify blur between 0 and 100\n  blur(blur: number) {\n    return this.withOptions({blur})\n  }\n\n  sharpen(sharpen: number) {\n    return this.withOptions({sharpen})\n  }\n\n  // Specify the desired rectangle of the image\n  rect(left: number, top: number, width: number, height: number) {\n    return this.withOptions({rect: {left, top, width, height}})\n  }\n\n  // Specify the image format of the image. 'jpg', 'pjpg', 'png', 'webp'\n  format(format?: ImageFormat | undefined) {\n    return this.withOptions({format})\n  }\n\n  invert(invert: boolean) {\n    return this.withOptions({invert})\n  }\n\n  // Rotation in degrees 0, 90, 180, 270\n  orientation(orientation: Orientation) {\n    return this.withOptions({orientation})\n  }\n\n  // Compression quality 0-100\n  quality(quality: number) {\n    return this.withOptions({quality})\n  }\n\n  // Make it a download link. Parameter is default filename.\n  forceDownload(download: boolean | string) {\n    return this.withOptions({download})\n  }\n\n  // Flip image horizontally\n  flipHorizontal() {\n    return this.withOptions({flipHorizontal: true})\n  }\n\n  // Flip image vertically\n  flipVertical() {\n    return this.withOptions({flipVertical: true})\n  }\n\n  // Ignore crop/hotspot from image record, even when present\n  ignoreImageParams() {\n    return this.withOptions({ignoreImageParams: true})\n  }\n\n  fit(value: FitMode) {\n    if (validFits.indexOf(value) === -1) {\n      throw new Error(`Invalid fit mode \"${value}\"`)\n    }\n\n    return this.withOptions({fit: value})\n  }\n\n  crop(value: CropMode) {\n    if (validCrops.indexOf(value) === -1) {\n      throw new Error(`Invalid crop mode \"${value}\"`)\n    }\n\n    return this.withOptions({crop: value})\n  }\n\n  // Saturation\n  saturation(saturation: number) {\n    return this.withOptions({saturation})\n  }\n\n  auto(value: AutoMode) {\n    if (validAutoModes.indexOf(value) === -1) {\n      throw new Error(`Invalid auto mode \"${value}\"`)\n    }\n\n    return this.withOptions({auto: value})\n  }\n\n  // Specify the number of pixels to pad the image\n  pad(pad: number) {\n    return this.withOptions({pad})\n  }\n\n  // Vanity URL for more SEO friendly URLs\n  vanityName(value: string) {\n    return this.withOptions({vanityName: value})\n  }\n\n  frame(frame: number) {\n    if (frame !== 1) {\n      throw new Error(`Invalid frame value \"${frame}\"`)\n    }\n\n    return this.withOptions({frame})\n  }\n\n  // Gets the url based on the submitted parameters\n  url() {\n    return urlForImage(this.options)\n  }\n\n  // Alias for url()\n  toString() {\n    return this.url()\n  }\n}\n"],"names":["example","parseAssetId","ref","_ref$split","split","id","dimensionString","format","Error","_dimensionString$spli","imgWidthStr","imgHeightStr","width","height","isValidAssetId","isFinite","isRef","src","source","_ref","isAsset","_id","isAssetStub","asset","url","isInProgressUpload","obj","_upload","parseSource","image","isUrl","urlToId","_extends","img","crop","hotspot","applyDefaults","test","parts","slice","replace","result","left","top","bottom","right","x","y","SPEC_NAME_TO_URL_NAME_MAPPINGS","urlForImage","options","spec","JSON","stringify","cropLeft","Math","round","cropTop","hotSpotVerticalRadius","hotSpotHorizontalRadius","hotSpotCenterX","hotSpotCenterY","rect","focalPoint","ignoreImageParams","fit","specToImageUrl","cdnUrl","baseUrl","vanityStub","vanityName","filename","projectId","dataset","params","_spec$rect","isEffectiveCrop","push","bg","flip","flipHorizontal","flipVertical","filter","Boolean","join","forEach","mapping","specName","param","encodeURIComponent","length","cropRect","imgWidth","imgHeight","desiredAspectRatio","cropAspectRatio","max","hotspotXCenter","hotspotYCenter","validFits","validCrops","validAutoModes","isSanityModernClientLike","client","config","isSanityClientLike","clientConfig","rewriteSpecName","key","specs","_iterator","_createForOfIteratorHelperLoose","_step","done","entry","value","urlBuilder","_options$config","apiUrl","apiHost","ImageUrlBuilder","_options$clientConfig","parent","_proto","prototype","withOptions","newOptions","hasOwnProperty","specKey","dpr","maxWidth","minWidth","maxHeight","minHeight","size","blur","sharpen","invert","orientation","quality","forceDownload","download","indexOf","saturation","auto","pad","frame","toString"],"mappings":"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"}