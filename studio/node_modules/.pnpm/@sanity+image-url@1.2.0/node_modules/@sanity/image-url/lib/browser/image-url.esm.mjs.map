{"version":3,"file":"image-url.esm.mjs","sources":["../../src/parseAssetId.ts","../../src/parseSource.ts","../../src/urlForImage.ts","../../src/builder.ts"],"sourcesContent":["const example = 'image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg'\n\nexport default function parseAssetId(ref: string) {\n  const [, id, dimensionString, format] = ref.split('-')\n\n  if (!id || !dimensionString || !format) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  const [imgWidthStr, imgHeightStr] = dimensionString.split('x')\n\n  const width = +imgWidthStr\n  const height = +imgHeightStr\n\n  const isValidAssetId = isFinite(width) && isFinite(height)\n  if (!isValidAssetId) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  return {id, width, height, format}\n}\n","import {\n  SanityAsset,\n  SanityImageObject,\n  SanityImageSource,\n  SanityImageWithAssetStub,\n  SanityReference,\n} from './types'\n\nconst isRef = (src: SanityImageSource): src is SanityReference => {\n  const source = src as SanityReference\n  return source ? typeof source._ref === 'string' : false\n}\n\nconst isAsset = (src: SanityImageSource): src is SanityAsset => {\n  const source = src as SanityAsset\n  return source ? typeof source._id === 'string' : false\n}\n\nconst isAssetStub = (src: SanityImageSource): src is SanityImageWithAssetStub => {\n  const source = src as SanityImageWithAssetStub\n  return source && source.asset ? typeof source.asset.url === 'string' : false\n}\n\n// Detect in-progress uploads (has upload key but no complete asset reference)\nexport const isInProgressUpload = (src: SanityImageSource): boolean => {\n  if (typeof src === 'object' && src !== null) {\n    const obj = src as any\n    // Check if it has an upload key (indicating in-progress upload)\n    return obj._upload && (!obj.asset || !obj.asset._ref)\n  }\n  return false\n}\n\n// Convert an asset-id, asset or image to an image record suitable for processing\n// eslint-disable-next-line complexity\nexport default function parseSource(source?: SanityImageSource) {\n  if (!source) {\n    return null\n  }\n\n  let image: SanityImageObject\n\n  if (typeof source === 'string' && isUrl(source)) {\n    // Someone passed an existing image url?\n    image = {\n      asset: {_ref: urlToId(source)},\n    }\n  } else if (typeof source === 'string') {\n    // Just an asset id\n    image = {\n      asset: {_ref: source},\n    }\n  } else if (isRef(source)) {\n    // We just got passed an asset directly\n    image = {\n      asset: source,\n    }\n  } else if (isAsset(source)) {\n    // If we were passed an image asset document\n    image = {\n      asset: {\n        _ref: source._id || '',\n      },\n    }\n  } else if (isAssetStub(source)) {\n    // If we were passed a partial asset (`url`, but no `_id`)\n    image = {\n      asset: {\n        _ref: urlToId(source.asset.url),\n      },\n    }\n  } else if (typeof source.asset === 'object') {\n    // Probably an actual image with materialized asset\n    image = {...source}\n  } else {\n    // We got something that does not look like an image, or it is an image\n    // that currently isn't sporting an asset.\n    return null\n  }\n\n  const img = source as SanityImageObject\n  if (img.crop) {\n    image.crop = img.crop\n  }\n\n  if (img.hotspot) {\n    image.hotspot = img.hotspot\n  }\n\n  return applyDefaults(image)\n}\n\nfunction isUrl(url: string) {\n  return /^https?:\\/\\//.test(`${url}`)\n}\n\nfunction urlToId(url: string) {\n  const parts = url.split('/').slice(-1)\n  return `image-${parts[0]}`.replace(/\\.([a-z]+)$/, '-$1')\n}\n\n// Mock crop and hotspot if image lacks it\nfunction applyDefaults(image: SanityImageObject) {\n  if (image.crop && image.hotspot) {\n    return image as Required<SanityImageObject>\n  }\n\n  // We need to pad in default values for crop or hotspot\n  const result = {...image}\n\n  if (!result.crop) {\n    result.crop = {\n      left: 0,\n      top: 0,\n      bottom: 0,\n      right: 0,\n    }\n  }\n\n  if (!result.hotspot) {\n    result.hotspot = {\n      x: 0.5,\n      y: 0.5,\n      height: 1.0,\n      width: 1.0,\n    }\n  }\n\n  return result as Required<SanityImageObject>\n}\n","import parseAssetId from './parseAssetId'\nimport parseSource, {isInProgressUpload} from './parseSource'\nimport {\n  CropSpec,\n  HotspotSpec,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAsset,\n  SanityAsset,\n  SanityImageFitResult,\n  SanityImageRect,\n  SanityReference,\n} from './types'\n\nexport const SPEC_NAME_TO_URL_NAME_MAPPINGS = [\n  ['width', 'w'],\n  ['height', 'h'],\n  ['format', 'fm'],\n  ['download', 'dl'],\n  ['blur', 'blur'],\n  ['sharpen', 'sharp'],\n  ['invert', 'invert'],\n  ['orientation', 'or'],\n  ['minHeight', 'min-h'],\n  ['maxHeight', 'max-h'],\n  ['minWidth', 'min-w'],\n  ['maxWidth', 'max-w'],\n  ['quality', 'q'],\n  ['fit', 'fit'],\n  ['crop', 'crop'],\n  ['saturation', 'sat'],\n  ['auto', 'auto'],\n  ['dpr', 'dpr'],\n  ['pad', 'pad'],\n  ['frame', 'frame'],\n]\n\nexport default function urlForImage(options: ImageUrlBuilderOptions): string {\n  let spec = {...(options || {})}\n  const source = spec.source\n  delete spec.source\n\n  const image = parseSource(source)\n  if (!image) {\n    if (source && isInProgressUpload(source)) {\n      // This is a placeholder image that will be replaced with the actual image when the upload is complete\n      // This is a 0x0 transparent PNG image\n      return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8HwQACfsD/QNViZkAAAAASUVORK5CYII='\n    }\n    throw new Error(`Unable to resolve image URL from source (${JSON.stringify(source)})`)\n  }\n\n  const id = (image.asset as SanityReference)._ref || (image.asset as SanityAsset)._id || ''\n  const asset = parseAssetId(id)\n\n  // Compute crop rect in terms of pixel coordinates in the raw source image\n  const cropLeft = Math.round(image.crop.left * asset.width)\n  const cropTop = Math.round(image.crop.top * asset.height)\n  const crop = {\n    left: cropLeft,\n    top: cropTop,\n    width: Math.round(asset.width - image.crop.right * asset.width - cropLeft),\n    height: Math.round(asset.height - image.crop.bottom * asset.height - cropTop),\n  }\n\n  // Compute hot spot rect in terms of pixel coordinates\n  const hotSpotVerticalRadius = (image.hotspot.height * asset.height) / 2\n  const hotSpotHorizontalRadius = (image.hotspot.width * asset.width) / 2\n  const hotSpotCenterX = image.hotspot.x * asset.width\n  const hotSpotCenterY = image.hotspot.y * asset.height\n  const hotspot = {\n    left: hotSpotCenterX - hotSpotHorizontalRadius,\n    top: hotSpotCenterY - hotSpotVerticalRadius,\n    right: hotSpotCenterX + hotSpotHorizontalRadius,\n    bottom: hotSpotCenterY + hotSpotVerticalRadius,\n  }\n\n  // If irrelevant, or if we are requested to: don't perform crop/fit based on\n  // the crop/hotspot.\n  if (!(spec.rect || spec.focalPoint || spec.ignoreImageParams || spec.crop)) {\n    spec = {...spec, ...fit({crop, hotspot}, spec)}\n  }\n\n  return specToImageUrl({...spec, asset})\n}\n\n// eslint-disable-next-line complexity\nfunction specToImageUrl(spec: ImageUrlBuilderOptionsWithAsset) {\n  const cdnUrl = (spec.baseUrl || 'https://cdn.sanity.io').replace(/\\/+$/, '')\n  const vanityStub = spec.vanityName ? `/${spec.vanityName}` : ''\n  const filename = `${spec.asset.id}-${spec.asset.width}x${spec.asset.height}.${spec.asset.format}${vanityStub}`\n  const baseUrl = `${cdnUrl}/images/${spec.projectId}/${spec.dataset}/${filename}`\n\n  const params = []\n\n  if (spec.rect) {\n    // Only bother url with a crop if it actually crops anything\n    const {left, top, width, height} = spec.rect\n    const isEffectiveCrop =\n      left !== 0 || top !== 0 || height !== spec.asset.height || width !== spec.asset.width\n\n    if (isEffectiveCrop) {\n      params.push(`rect=${left},${top},${width},${height}`)\n    }\n  }\n\n  if (spec.bg) {\n    params.push(`bg=${spec.bg}`)\n  }\n\n  if (spec.focalPoint) {\n    params.push(`fp-x=${spec.focalPoint.x}`)\n    params.push(`fp-y=${spec.focalPoint.y}`)\n  }\n\n  const flip = [spec.flipHorizontal && 'h', spec.flipVertical && 'v'].filter(Boolean).join('')\n  if (flip) {\n    params.push(`flip=${flip}`)\n  }\n\n  // Map from spec name to url param name, and allow using the actual param name as an alternative\n  SPEC_NAME_TO_URL_NAME_MAPPINGS.forEach((mapping) => {\n    const [specName, param] = mapping\n    if (typeof spec[specName] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[specName])}`)\n    } else if (typeof spec[param] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[param])}`)\n    }\n  })\n\n  if (params.length === 0) {\n    return baseUrl\n  }\n\n  return `${baseUrl}?${params.join('&')}`\n}\n\nfunction fit(\n  source: {crop: CropSpec; hotspot: HotspotSpec},\n  spec: ImageUrlBuilderOptions\n): SanityImageFitResult {\n  let cropRect: SanityImageRect\n\n  const imgWidth = spec.width\n  const imgHeight = spec.height\n\n  // If we are not constraining the aspect ratio, we'll just use the whole crop\n  if (!(imgWidth && imgHeight)) {\n    return {width: imgWidth, height: imgHeight, rect: source.crop}\n  }\n\n  const crop = source.crop\n  const hotspot = source.hotspot\n\n  // If we are here, that means aspect ratio is locked and fitting will be a bit harder\n  const desiredAspectRatio = imgWidth / imgHeight\n  const cropAspectRatio = crop.width / crop.height\n\n  if (cropAspectRatio > desiredAspectRatio) {\n    // The crop is wider than the desired aspect ratio. That means we are cutting from the sides\n    const height = Math.round(crop.height)\n    const width = Math.round(height * desiredAspectRatio)\n    const top = Math.max(0, Math.round(crop.top))\n\n    // Center output horizontally over hotspot\n    const hotspotXCenter = Math.round((hotspot.right - hotspot.left) / 2 + hotspot.left)\n    let left = Math.max(0, Math.round(hotspotXCenter - width / 2))\n\n    // Keep output within crop\n    if (left < crop.left) {\n      left = crop.left\n    } else if (left + width > crop.left + crop.width) {\n      left = crop.left + crop.width - width\n    }\n\n    cropRect = {left, top, width, height}\n  } else {\n    // The crop is taller than the desired ratio, we are cutting from top and bottom\n    const width = crop.width\n    const height = Math.round(width / desiredAspectRatio)\n    const left = Math.max(0, Math.round(crop.left))\n\n    // Center output vertically over hotspot\n    const hotspotYCenter = Math.round((hotspot.bottom - hotspot.top) / 2 + hotspot.top)\n    let top = Math.max(0, Math.round(hotspotYCenter - height / 2))\n\n    // Keep output rect within crop\n    if (top < crop.top) {\n      top = crop.top\n    } else if (top + height > crop.top + crop.height) {\n      top = crop.top + crop.height - height\n    }\n\n    cropRect = {left, top, width, height}\n  }\n\n  return {\n    width: imgWidth,\n    height: imgHeight,\n    rect: cropRect,\n  }\n}\n\n// For backwards-compatibility\nexport {parseSource}\n","import type {\n  AutoMode,\n  CropMode,\n  FitMode,\n  ImageFormat,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAliases,\n  SanityModernClientLike,\n  Orientation,\n  SanityClientLike,\n  SanityImageSource,\n  SanityProjectDetails,\n} from './types'\nimport urlForImage, {SPEC_NAME_TO_URL_NAME_MAPPINGS} from './urlForImage'\n\nconst validFits = ['clip', 'crop', 'fill', 'fillmax', 'max', 'scale', 'min']\nconst validCrops = ['top', 'bottom', 'left', 'right', 'center', 'focalpoint', 'entropy']\nconst validAutoModes = ['format']\n\nfunction isSanityModernClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityModernClientLike {\n  return client && 'config' in client ? typeof client.config === 'function' : false\n}\n\nfunction isSanityClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityClientLike {\n  return client && 'clientConfig' in client ? typeof client.clientConfig === 'object' : false\n}\n\nfunction rewriteSpecName(key: string) {\n  const specs = SPEC_NAME_TO_URL_NAME_MAPPINGS\n  for (const entry of specs) {\n    const [specName, param] = entry\n    if (key === specName || key === param) {\n      return specName\n    }\n  }\n\n  return key\n}\n\nexport default function urlBuilder(\n  options?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n) {\n  // Did we get a modernish client?\n  if (isSanityModernClientLike(options)) {\n    // Inherit config from client\n    const {apiHost: apiUrl, projectId, dataset} = options.config()\n    const apiHost = apiUrl || 'https://api.sanity.io'\n    return new ImageUrlBuilder(null, {\n      baseUrl: apiHost.replace(/^https:\\/\\/api\\./, 'https://cdn.'),\n      projectId,\n      dataset,\n    })\n  }\n\n  // Did we get a SanityClient?\n  if (isSanityClientLike(options)) {\n    // Inherit config from client\n    const {apiHost: apiUrl, projectId, dataset} = options.clientConfig\n    const apiHost = apiUrl || 'https://api.sanity.io'\n    return new ImageUrlBuilder(null, {\n      baseUrl: apiHost.replace(/^https:\\/\\/api\\./, 'https://cdn.'),\n      projectId,\n      dataset,\n    })\n  }\n\n  // Or just accept the options as given\n  return new ImageUrlBuilder(null, options || {})\n}\n\nexport class ImageUrlBuilder {\n  public options: ImageUrlBuilderOptions\n\n  constructor(parent: ImageUrlBuilder | null, options: ImageUrlBuilderOptions) {\n    this.options = parent\n      ? {...(parent.options || {}), ...(options || {})} // Merge parent options\n      : {...(options || {})} // Copy options\n  }\n\n  withOptions(options: Partial<ImageUrlBuilderOptionsWithAliases>) {\n    const baseUrl = options.baseUrl || this.options.baseUrl\n\n    const newOptions: {[key: string]: any} = {baseUrl}\n    for (const key in options) {\n      if (options.hasOwnProperty(key)) {\n        const specKey = rewriteSpecName(key)\n        newOptions[specKey] = options[key]\n      }\n    }\n\n    return new ImageUrlBuilder(this, {baseUrl, ...newOptions})\n  }\n\n  // The image to be represented. Accepts a Sanity 'image'-document, 'asset'-document or\n  // _id of asset. To get the benefit of automatic hot-spot/crop integration with the content\n  // studio, the 'image'-document must be provided.\n  image(source: SanityImageSource) {\n    return this.withOptions({source})\n  }\n\n  // Specify the dataset\n  dataset(dataset: string) {\n    return this.withOptions({dataset})\n  }\n\n  // Specify the projectId\n  projectId(projectId: string) {\n    return this.withOptions({projectId})\n  }\n\n  // Specify background color\n  bg(bg: string) {\n    return this.withOptions({bg})\n  }\n\n  // Set DPR scaling factor\n  dpr(dpr: number) {\n    // A DPR of 1 is the default - so only include it if we have a different value\n    return this.withOptions(dpr && dpr !== 1 ? {dpr} : {})\n  }\n\n  // Specify the width of the image in pixels\n  width(width: number) {\n    return this.withOptions({width})\n  }\n\n  // Specify the height of the image in pixels\n  height(height: number) {\n    return this.withOptions({height})\n  }\n\n  // Specify focal point in fraction of image dimensions. Each component 0.0-1.0\n  focalPoint(x: number, y: number) {\n    return this.withOptions({focalPoint: {x, y}})\n  }\n\n  maxWidth(maxWidth: number) {\n    return this.withOptions({maxWidth})\n  }\n\n  minWidth(minWidth: number) {\n    return this.withOptions({minWidth})\n  }\n\n  maxHeight(maxHeight: number) {\n    return this.withOptions({maxHeight})\n  }\n\n  minHeight(minHeight: number) {\n    return this.withOptions({minHeight})\n  }\n\n  // Specify width and height in pixels\n  size(width: number, height: number) {\n    return this.withOptions({width, height})\n  }\n\n  // Specify blur between 0 and 100\n  blur(blur: number) {\n    return this.withOptions({blur})\n  }\n\n  sharpen(sharpen: number) {\n    return this.withOptions({sharpen})\n  }\n\n  // Specify the desired rectangle of the image\n  rect(left: number, top: number, width: number, height: number) {\n    return this.withOptions({rect: {left, top, width, height}})\n  }\n\n  // Specify the image format of the image. 'jpg', 'pjpg', 'png', 'webp'\n  format(format?: ImageFormat | undefined) {\n    return this.withOptions({format})\n  }\n\n  invert(invert: boolean) {\n    return this.withOptions({invert})\n  }\n\n  // Rotation in degrees 0, 90, 180, 270\n  orientation(orientation: Orientation) {\n    return this.withOptions({orientation})\n  }\n\n  // Compression quality 0-100\n  quality(quality: number) {\n    return this.withOptions({quality})\n  }\n\n  // Make it a download link. Parameter is default filename.\n  forceDownload(download: boolean | string) {\n    return this.withOptions({download})\n  }\n\n  // Flip image horizontally\n  flipHorizontal() {\n    return this.withOptions({flipHorizontal: true})\n  }\n\n  // Flip image vertically\n  flipVertical() {\n    return this.withOptions({flipVertical: true})\n  }\n\n  // Ignore crop/hotspot from image record, even when present\n  ignoreImageParams() {\n    return this.withOptions({ignoreImageParams: true})\n  }\n\n  fit(value: FitMode) {\n    if (validFits.indexOf(value) === -1) {\n      throw new Error(`Invalid fit mode \"${value}\"`)\n    }\n\n    return this.withOptions({fit: value})\n  }\n\n  crop(value: CropMode) {\n    if (validCrops.indexOf(value) === -1) {\n      throw new Error(`Invalid crop mode \"${value}\"`)\n    }\n\n    return this.withOptions({crop: value})\n  }\n\n  // Saturation\n  saturation(saturation: number) {\n    return this.withOptions({saturation})\n  }\n\n  auto(value: AutoMode) {\n    if (validAutoModes.indexOf(value) === -1) {\n      throw new Error(`Invalid auto mode \"${value}\"`)\n    }\n\n    return this.withOptions({auto: value})\n  }\n\n  // Specify the number of pixels to pad the image\n  pad(pad: number) {\n    return this.withOptions({pad})\n  }\n\n  // Vanity URL for more SEO friendly URLs\n  vanityName(value: string) {\n    return this.withOptions({vanityName: value})\n  }\n\n  frame(frame: number) {\n    if (frame !== 1) {\n      throw new Error(`Invalid frame value \"${frame}\"`)\n    }\n\n    return this.withOptions({frame})\n  }\n\n  // Gets the url based on the submitted parameters\n  url() {\n    return urlForImage(this.options)\n  }\n\n  // Alias for url()\n  toString() {\n    return this.url()\n  }\n}\n"],"names":["example","parseAssetId","ref","_ref$split","split","id","dimensionString","format","Error","_dimensionString$spli","imgWidthStr","imgHeightStr","width","height","isValidAssetId","isFinite","isRef","src","source","_ref","isAsset","_id","isAssetStub","asset","url","isInProgressUpload","obj","_upload","parseSource","image","isUrl","urlToId","_extends","img","crop","hotspot","applyDefaults","test","parts","slice","replace","result","left","top","bottom","right","x","y","SPEC_NAME_TO_URL_NAME_MAPPINGS","urlForImage","options","spec","JSON","stringify","cropLeft","Math","round","cropTop","hotSpotVerticalRadius","hotSpotHorizontalRadius","hotSpotCenterX","hotSpotCenterY","rect","focalPoint","ignoreImageParams","fit","specToImageUrl","cdnUrl","baseUrl","vanityStub","vanityName","filename","projectId","dataset","params","_spec$rect","isEffectiveCrop","push","bg","flip","flipHorizontal","flipVertical","filter","Boolean","join","forEach","mapping","specName","param","encodeURIComponent","length","cropRect","imgWidth","imgHeight","desiredAspectRatio","cropAspectRatio","max","hotspotXCenter","hotspotYCenter","validFits","validCrops","validAutoModes","isSanityModernClientLike","client","config","isSanityClientLike","clientConfig","rewriteSpecName","key","specs","_iterator","_createForOfIteratorHelperLoose","_step","done","entry","value","urlBuilder","_options$config","apiUrl","apiHost","ImageUrlBuilder","_options$clientConfig","parent","_proto","prototype","withOptions","newOptions","hasOwnProperty","specKey","dpr","maxWidth","minWidth","maxHeight","minHeight","size","blur","sharpen","invert","orientation","quality","forceDownload","download","indexOf","saturation","auto","pad","frame","toString"],"mappings":"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"}